(library
 (name illuaminateLsp)
 (modules
  (:standard \ illuaminate_lsp))
 (libraries
  cmdliner
  containers
  fpath
  illuaminate.config
  illuaminateConfigFormat
  illuaminate.core
  illuaminate.data
  illuaminate.lint
  illuaminate.parser
  illuaminate.semantics
  logs
  str
  fmt
  jsonrpc
  lsp
  lsp.stdune
  lsp.fiber
  mtime
  mtime.clock.os
  omd
  result
  yojson
  ppx_yojson_conv_lib)
 (instrumentation
  (backend bisect_ppx)))

(executable
 (name illuaminate_lsp)
 (modules illuaminate_lsp)
 (modes exe)
 (libraries
  unix
  illuaminateLsp
  cmdliner
  lsp
  logs
  yojson
  lsp.stdune
  lsp.fiber
  lsp.fiber_unix
  lsp_fiber))

(rule
 (target illuaminate_lsp.strip.exe)
 (action
  (run strip -o %{target} %{dep:illuaminate_lsp.exe}))
 (enabled_if
  (= %{system} "linux")))

(rule
 (target illuaminate_lsp.min.exe)
 (action
  (run upx -o %{target} %{dep:illuaminate_lsp.strip.exe}))
 (enabled_if
  (= %{system} "linux")))

(rule
 (target illuaminate_lsp.min.exe)
 (action
  (copy %{dep:illuaminate_lsp.exe} %{target}))
 (enabled_if
  (<> %{system} "linux")))
