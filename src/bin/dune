(library
 (name illuaminate)
 (modules illuaminate config loader lex_template)
 (libraries containers cmdliner fpath illuaminate.core illuaminate.parser
   illuaminate.semantics illuaminate.lint illuaminate.config illuaminate.html
   illuaminate.pattern illuaminate.github illuaminate.doc_emit
   illuaminate.exec omd result))

(ocamllex
 (modules lex_template))

(executable
 (name illuaminate_all)
 (libraries illuaminate)
 (modules illuaminate_all)
 (modes exe)
 (variants unix))

(executable
 (name illuaminate_small)
 (libraries illuaminate)
 (modules illuaminate_small)
 (modes exe))

(executable
 (name illuaminate_js)
 (modules illuaminate_js)
 (libraries illuaminate)
 (modes js)
 (variants js)
 (js_of_ocaml
  (javascript_files runtime.js)
  (flags "--opt=3" "--custom-header=#!/usr/bin/env node")))

(rule
 (target illuaminate_all.min.exe)
 (deps illuaminate_all.exe)
 (action
  (run upx -o %{target} %{deps})))

(rule
 (target illuaminate_small.min.exe)
 (deps illuaminate_small.exe)
 (action
  (run upx -o %{target} %{deps})))

(install
 (section bin)
 (package illuaminate)
 (files
  (illuaminate_all.min.exe as illuaminate)
  (illuaminate_small.min.exe as illuaminate.min)
  (illuaminate_js.bc.js as illuaminate.js)))
