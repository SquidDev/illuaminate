(library
 (name illuaminate)
 (modules illuaminate config loader lex_template)
 (libraries containers cmdliner fpath illuaminate.core illuaminate.data
   illuaminate.parser illuaminate.semantics illuaminate.lint
   illuaminate.config illuaminate.html illuaminate.pattern illuaminate.github
   illuaminate.doc_emit illuaminate.exec omd result logs))

(ocamllex
 (modules lex_template))

(executable
 (name illuaminate_all)
 (libraries illuaminate)
 (modules illuaminate_all)
 (modes exe)
 (variants unix))

(executable
 (name illuaminate_js)
 (modules illuaminate_js)
 (libraries illuaminate)
 (modes js)
 (variants js)
 (js_of_ocaml
  (javascript_files runtime.js)
  (flags "--opt=3" "--custom-header=#!/usr/bin/env node")))

(rule
 (target illuaminate_all.min.exe)
 (deps illuaminate_all.exe)
 (action
  (run upx -o %{target} %{deps})))

(install
 (section bin)
 (package illuaminate)
 (files
  (illuaminate_all.min.exe as illuaminate)
  (illuaminate_js.bc.js as illuaminate.js)))
